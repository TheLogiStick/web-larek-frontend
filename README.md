# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- `src/` — исходные файлы проекта
- `src/components/` — папка с JS компонентами
- `src/components/base/` — папка с базовым кодом

Важные файлы:

- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

_Интерфейс для карточки товара_

```
interface ICard {
	category: string;
	name: string;
	image: string;
	price: number | null;
	id: string;
	description: string;
}
```

_Интерфейс корзины_

```
interface IBasket {
	cards: ICard[];
	totalPrice: number | null;
}
```

_Интерфейс для данных заказа_

```
interface IOrder {
	paymentMethod: 'Онлайн' | 'При получении';
	deliveryAddress: string | null;
	email: string | null;
	phone: string | null;
	totalPrice: number | null;
	lastTotalPrice: number | null;
	currentStep: number | null;
}
```

_Интерфейс формы заказа_

```
type TFormOrder = Pick<IOrder, 'paymentMethod' | 'deliveryAddress'>;
```

_Интерфейс формы контактов_

```
type TFormContacts = Pick<IOrder, 'email' | 'phone'>;
```

_Интерфейс методов запроса к серверу_

```
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE' | 'PATCH';
```

_Интерфейс api_

```
interface IApi {
	baseUrl: string;
	get<T>(uri: string): Promise<T>;
	post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T>;
}
```

## Архитектура приложения

Код организован согласно парадигме MVP:

- Слой представления — отображает данные.
- Слой данных — отвечает за хранение данных.
- Презентер — связывает представление и данные.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Базовый Класс Component

Класс является дженериком.\
В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте.\
В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента.\
Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс CardsData

Класс отвечает за хранение и логику работы с данными карточек созданных пользователями.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- `cards: ICard[]` - массив объектов карточек.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- `addCards(cards: ICard[]): void` - добавляет карточки товаров на страницу.
- `getCard(cardId: string): ICard` - возвращает карточку по ее id.
- а также сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BasketData

Реализует интерфейс `IBasket`.\
Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- `cards: ICard[]` - массив карточек в корзине.
- `totalPrice: number | null` - итоговая цена корзины.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

- `addCardToBasket(card: ICard): void` - добавляет одну карточку в начало массива.
- `removeCardFromBasket(card: ICard): void` - Удаляет карточку из массива.
- `getCardFromBasket(cardId: string): ICard` - возвращает карточку по ее id.
- `checkOrderValidity(orderData: IOrder): boolean` - делает проверку данных заказа на наличие пустых полей.
- геттеры и сеттеры итоговой цены корзины.

### Класс Order

Класс реализует интерфейс `IOrder` и отвечает за хранение данных о заказе.

Поля класса

- `paymentMethod` - Способ оплаты.
- `deliveryAddress` - Адрес доставки.
- `email` - Адрес электронной почты.
- `phone` - Номер телефона.
- `totalPrice` - Общую стоимость заказа.
- `lastTotalPrice` - Последняя стоимость заказа.
- `currentStep` - Текущий этап оформления заказа.

Методы класса

- `clearOrder(): void` - очищает данные заказа.
- сеттеры и геттеры данных заказа.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элементе) передаваемых в них данных.

#### Класс Modal

Расширяет класс `Component`.\
Реализует модальное окно. Методам `render` заполняет контейнер модального окна необходимым содержимым, так же предоставляет методы `open` и `close` для управления отображением модального окна.\
Дополнительно устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- `constructor` (`template: HTMLElement`, `container: HTMLElement`, `events: IEvents`) Конструктор принимает шаблон модального окна, контейнер в который будет помещено модальное окно и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса

- `closeButton`: кнопка для закрытия модального окна.
- `content`: контейнер, содержащий основное содержимое модального окна.

Методы класса

- `render(data: HTMLElement): HTMLElement` - Рендерит форму с указанным содержимым и открывает его.
- `open(): void` - Раскрывает модальное окно.
- `close(): void` - Скрывает модальное окно и очищает его содержимое.
- сеттер для замены содержимого модального окна.

### Класс Form

Расширяет класс `Component`.\
Реализует общий компонент формы.\
Предоставляет базовые методы и сеттеры для работы с отображением элементов формы.

`constructor` (`template: HTMLElement`, `events: IEvents`) Конструктор принимает шаблон формы и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса

- `submitButton: HTMLButtonElement` - Кнопка подтверждения.
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы.
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов.

Методы класса

- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем.
- `checkValidation(inputValues: Record<string, string>):boolean` - проверяет поля формы на валидность.
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода.
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода.
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода.
- `render(data: Partial<T>): HTMLElement` - Рендерит форму с указанным содержимым и открывает его.
- сеттер для изменения состояния кнопки подтверждения

Методы:

- `checkValidation(inputValues: Record<string, string>):boolean` - проверяет поля формы на валидность.
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем.
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода.
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода.
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода.
- сеттер для изменения состояния кнопки подтверждения

### Класс FormOrder

Расширяет класс `Form`.\
Реализует тип `TFormOrder`.\
Предназначен для реализации компонента формы заказа.

`constructor` (`template: HTMLElement`, `events: IEvents`) Конструктор принимает шаблон формы и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса

- `paymentCardButton: HTMLButtonElement` — кнопка для оплаты онлайн.
- `paymentCashButton: HTMLButtonElement` — кнопка для оплаты наличными при получении.
- `addressInput: HTMLInputElement` - поле для ввода адреса.

Методы класса

- `togglePaymentButtonState` - переключает состояние кнопок оплаты онлайн или наличными.
- сеттеры для выбора оплаты и адреса.

### Класс FormContacts

Расширяет класс `Form`.\
Реализует тип `TFormContacts`.\
Предназначен для реализации компонента формы контактных данных.

`constructor` (`template: HTMLElement`, `events: IEvents`) Конструктор принимает шаблон формы и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса

- `emailInput: HTMLInputElement` — поле для ввода почты.
- `phoneInput: HTMLInputElement` — поле для ввода телефонного номера.

Методы класса

- сеттеры для почты и телефонного номера.

### Класс Success

Расширяет класс `Component`.\
Предназначен для реализации компонента подтверждения заказа.

- `constructor` (`template: HTMLElement`, `container: HTMLElement`, `events: IEvents`) Конструктор принимает шаблон модального окна, контейнер в который будет помещено модальное окно и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса

- `_totalPrice: Pick<IOrder, 'lastTotalPrice'>` — итоговая стоимость заказа.

Методы класса

- сеттер для изменения итоговой стоимости заказа.

#### Класс ModalBasket

Расширяет класс `Component`.\
Предназначен для реализации корзины.\
Устанавливает слушатели на кнопки удаления карточек из корзины.

- `constructor` (`template: HTMLElement`, `container: HTMLElement`, `events: IEvents`) Конструктор принимает шаблон модального окна, контейнер в который будет помещено модальное окно и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса:

- `submitButton: HTMLButtonElement` - Кнопка подтверждения.
- `_totalPrice: Pick<IBasket, 'totalPrice'>` - итоговая стоимость корзины.
- `events: IEvents` - брокер событий.

Методы класса:

- сеттер для изменения состояния кнопки подтверждения
- сеттер для установки содержимого корзины.
- сеттер для установки итоговой стоимости корзины.

#### Класс Card

Расширяет класс `Component`.\
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, цены и категории.\
Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент шаблона\
В классе устанавливаются слушатель на открытие превью данной карточки и динамический слушатель на кнопку карточки.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме шаблона принимает экземпляр `EventEmitter` для инициализации событий.

- `constructor` (`template: HTMLElement`, `container: HTMLElement`, `events: IEvents`) Конструктор принимает шаблон карточки, контейнер в который будет помещена карточка и экземпляр класса `EventEmitter` для возможности инициализации событий.

Методы:

- `render(cardData: ICard): HTMLElement` - заполняет данные карточки.
- `setShowPreviewHandler(): void` - устанавливает обработчик клика на карточку, который вызывает событие `card:select`.
- `setButtonHandler(eventName: string): void` - устанавливает обработчик клика на кнопку карточки, который вызовет событие переданное в `eventName`.
- сеттеры для установки данных карточки.
- сеттеры для изменения состояния и текста кнопки.

### Слой коммуникации

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### Список всех событий

#### События изменения данных (генерируются классами моделями данных)

- `cards:changed` - изменение массива карточек.
- `basket:change` - изменение корзины.

#### События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)

- `card:select` - выбор карточки для отображения в модальном окне.
- `basket:open` - открытие корзины.
- `basket:submit` - переход на начало цепочки покупки.
- `order:submit` - начало цепочки покупки. Записываем значения способа получения и адреса доставки в класс `orderData`. И переходим к следующему этапу оформления заказа.
- `contacts:submit` - Записываем почту и номер телефона в класс `orderData`. Отправляем данные на сервер и переходим к последнему этапу оформления заказа.
- `success:submit` - очищаем класс `orderData` и закрываем модалку.
- `card:add-to-basket` - добавление карточки в корзину.
- `card:delete-from-basket` - удаление карточки из корзины.
