# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- `src/` — исходные файлы проекта
- `src/components/` — папка с JS компонентами
- `src/components/base/` — папка с базовым кодом

Важные файлы:

- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс для карточки товара

```
interface ICard {
	category: string;
	name: string;
	image: string;
	price: number;
	id: string;
}
```

Интерфейс для превью карточки товара

```
interface ICardPreview extends ICard {
	description: string;
}
```

Интерфейс для карточки в корзине

```
interface IBasketCard {
	id: string;
	name: string;
	price: string;
}
```

Интерфейс для данных заказа

```
interface IOrder {
	paymentMethod: 'Онлайн' | 'При получении';
	deliveryAddress: string | null;
	email: string | null;
	phone: string | null;
	totalPrice: number;
}
```

## Архитектура приложения

Код организован согласно парадигме MVP:

- Слой представления — отображает данные.
- Слой данных — отвечает за хранение данных.
- Презентер — связывает представление и данные.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс CardsData

Класс отвечает за хранение и логику работы с данными карточек созданных пользователями.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- `_cards: ICard[]` - массив объектов карточек.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- `addCard(card: ICard): void` - добавляет одну карточку в начало массива.
- `getCard(cardId: string): ICard` - возвращает карточку по ее id.
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BasketData

Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- `cards: IBasketCard[]` - массив карточек в корзине.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- `orderData: IOrder` - реализует интерфейс IOrder, содержит информацию о заказе.

- `addCardToBasket(card: ICard): void` - добавляет одну карточку в начало массива.
- `removeCardFromBasket(card: ICard): void` - Удаляет карточку из массива.
- `getCardFromBasket(cardId: string): ICard` - возвращает карточку по ее id.
- `sendOrderData(orderData: IOrder): void` - отправляет данные на сервер.
- `checkOrderValidity(orderData: IOrder): boolean` - делает проверку данных заказа на наличие пустых полей.
- геттеры и сеттеры для получения и установки данных заказа.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. При использовании метода `open` идёт проверка на существование данной модалки; новый экземпляр модалки будет создаваться только при его отсутствие в DOM. Дополнительно устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\

- `constructor` (`selector: string`, `container: HTMLElement`, `events: IEvents`) Конструктор принимает селектор, по которому в разметке страницы будет идентифицирован шаблон модального окна, контейнер в который будет помещено модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса

- `modal: HTMLElement` - элемент модального окна.
- `container: HTMLElement` - контейнер в который будет помещено модальное окно.
- `events: IEvents` - брокер событий.

#### Класс ModalWithPreview

Расширяет класс `Modal`. Предназначен для реализации модального окна с превью карточки. При открытии модального окна сохраняет полученную в параметрах карточку, которую передает в корзину при нажатии на кнопку. При открытие проверяет поле цены карточки и делает проверку на наличие товара в корзине.\
Поля класса:

- `submitButton: HTMLButtonElement` - Кнопка подтверждения.
- `basketCards: IBasketCard[]` - карточки в корзине.

Методы:

- `render(card: ICard): HTMLElement` - отрисовывает превью карточки.
- `checkCard(card: ICard):void` - проверяет карточку на наличия её в корзине, а также возможности её купить, вызывает `toggleButton`, и устанавливает слушатель с брокером событий с необходимым событием.
- `toggleButton(submitButton: HTMLButtonElement, buttonText: string, state: boolean): void` - переключает состояние кнопки и текст кнопки в зависимости от наличия карточки в корзине.

#### Класс ModalWithForm

Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:

- `submitButton: HTMLButtonElement` - Кнопка подтверждения.
- `_form: HTMLFormElement` - элемент формы.
- `_formName: string` - значение атрибута name формы.
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы.
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов.

Методы:

- `checkValidation(inputValues: Record<string, string>):boolean` - проверяет поля формы на валидность.
- `toggleButton(isValid: boolean): void` - изменяет активность кнопки подтверждения.
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем.
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода.
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода.
- `close (): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения.
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода

#### Класс ModalBasket

Расширяет класс Modal. Предназначен для реализации модального окна корзины. Устанавливает слушатели на кнопки удаления карточек из корзины.

- `constructor` (`selector: string`, `container: HTMLElement`, `events: IEvents`) Конструктор принимает селектор, по которому в разметке страницы будет идентифицирован шаблон модального окна, контейнер в который будет помещено модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `basketList: IBasketCard[]` - список всех карточек в корзине.
- `submitButton: HTMLButtonElement` - Кнопка подтверждения.
- `orderData: IOrder` - данные о заказе.
- `events: IEvents` - брокер событий.

Методы класса:

- `render(Data: IBasketData): HTMLElement` - отрисовывает корзину.
- сеттеры для установки данных корзины.

#### Класс Card

Отвечает за отображение карточки, задавая в карточке данные названия, изображения, цены и категории. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатель на открытие превью данной карточки.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:

- `render(cardData: ICard): HTMLElement` - заполняет данные карточки.

#### Класс CardsContainer

Отвечает за отображение блока с карточками на главной странице.

- `constructor` (`container: HTMLElement`) Конструктор принимает контейнер в который будет помещены карточки.

- `render(cards: ICard[])` - принимает массив элементов разметки карточек, который отображает в контейнере.

### Слой коммуникации

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### Список всех событий

#### События изменения данных (генерируются классами моделями данных)

- `cards:changed` - изменение массива карточек.
- `basket:change` - изменение корзины.

#### События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)

- `card:select` - выбор карточки для отображения в модальном окне.
- `basket:open` - открытие корзины.
- `basket:submit` - переход на начало цепочки покупки.
- `order:submit` - начало цепочки покупки. Записываем значения способа получения и адреса доставки в объект `orderData`. И переходим к следующему этапу оформления заказа.
- `contacts:submit` - Записываем почту и номер телефона в объект `orderData`. И переходим к следующему этапу оформления заказа.
- `success:submit` - очищаем объект `orderData` и закрываем модалку.
- `card:add-to-basket` - добавление карточки в корзину.
- `card:delete-from-basket` - удаление карточки из корзины.
